box: python:3.5
services:
  - id: postgres
    env:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
build:
  steps:
    - pip-install:
      requirements_file: "requirements.txt"
    
    - script:
      name: echo python information
      code: |
        python --version
    
    - script:        
      name: run pep8 tests
      code: |
        tox -e pep8
    
    - script:          
      name: echo postgres url
      code: |
        $WERCKER_POSTGRESQL_URL

    - script:
      name: echo services
      code: |
        service --status-all

    - script:
      name: echo psql version
      code: |
        psql --version

    - script:
      name: init DB
      code: |
        psql -U postgres -W postgres -d postgres < polls/sql/init_db.sql
#        psql -U $POSTGRES_USER -W $POSTGRES_PASSWORD -d $POSTGRES_DB < polls/sql/init_db.sql

    - script:
      name: create tables
      code: |
        psql -U postgres -W postgres -d postgres < polls/sql/create_tables.sql
