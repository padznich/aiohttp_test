box: python:3.5
services:
   - id: postgres
     env:
       POSTGRES_PASSWORD: postgres
       POSTGRES_USER: postgres
build:
  steps:
    - install-packages:
        packages: postgresql postgresql-contrib

    - pip-install:
      requirements_file: "requirements.txt"
    
    - script:
      name: echo python information
      code: |
        python --version
    
    - script:        
      name: run pep8 tests
      code: |
        tox -e pep8

    - script:
      name: echo services
      code: |
        service --status-all

    - script:
      name: echo psql version
      code: |
        psql --version

    - script:
      name: init DB
      code: |
        psql -U postgres -W postgres < polls/sql/init_db.sql

    - script:
      name: create tables
      code: |
        psql -U postgres -W postgres -d postgres < polls/sql/create_tables.sql
