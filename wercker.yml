box: python:3.5
services:
   - id: postgres
     env:
       POSTGRES_DB: postgres
       POSTGRES_PASSWORD: postgres
       POSTGRES_USER: postgres
build:
  steps:
    - pip-install:
        requirements_file: "requirements.txt"
    
    - script:    
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          
        name: run unit tests
        code: |
          pytest -v
        
        name: run unit tests
        code: |
          pytest -v --pep8
          
        name: extension test
        code: |
          sudo -u postgres psql postgres < polls/sql/init_db.sql
          sudo -u postgres psql postgres -d polls < polls/sql/create_tables.sql
