box: python:3.5
services:
   - id: postgres
     env:
       POSTGRES_DB: postgres
       POSTGRES_PASSWORD: postgres
       POSTGRES_USER: postgres
build:
  steps:
  
    - virtualenv:
      name: venv
    
    - script:
        name: pip install
        code: |
          pip install --download-cache=$WERCKER_CACHE_DIR -r requirements.txt
    
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          
        name: run unit tests
        code: |
          pytest -v
        
        name: run unit tests
        code: |
          pytest -v --pep8
          
        name: extension test
        code: |
          sudo -u postgres psql postgres < polls/sql/init_db.sql
          sudo -u postgres psql postgres -d polls < polls/sql/create_tables.sql
